<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CSE Department – Admin Panel</title>
<link rel="icon" href="image.png" />

<!-- Theme Bootstrap -->
<script>
(function () {
    const saved = localStorage.getItem('theme');
    const prefersDark = window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = saved || (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
})();
</script>

<link rel="stylesheet" href="styles.css" />

<style>
/* Loader */
.loader {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 55px;
    height: 55px;
    margin-top: -27px;
    margin-left: -27px;
    border: 5px solid #bbb;
    border-top-color: #7D2AE8;
    border-radius: 50%;
    animation: spin 0.9s linear infinite;
    z-index: 5000;
    display: none;
}
@keyframes spin { to { transform: rotate(360deg); } }

.admin-page {
    max-width: 1200px;
    margin: 120px auto 40px;
    display: none;
    padding: 0 20px 40px;
}

.login-screen {
    max-width: 360px;
    margin: 150px auto;
    padding: 24px;
    background: var(--card-bg);
    border: 1px solid var(--border-subtle);
    border-radius: 14px;
    text-align: center;
}

.btn-primary {
    background: #7D2AE8;
    color: #fff;
    width: 100%;
    padding: 10px 20px;
    border-radius: 100px;
    border: none;
    cursor: pointer;
    font-weight: 600;
}

.admin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(330px,1fr));
    gap: 20px;
}
.admin-card {
    padding: 18px;
    background: var(--card-bg);
    border-radius: 14px;
    border: 1px solid var(--border-subtle);
}
.form-frame{
    display:none;
    margin-top:12px;
    border-radius:10px;
    overflow:hidden;
    border:1px solid var(--border-subtle);
}
iframe{
    width:100%;
    height:420px;
    border:none;
}
.login-error{
    margin-top:10px;
    color:#e00;
    display:none;
}
</style>

</head>

<body>

<!-- NAVBAR -->
<nav class="nav">
    <div class="nav-inner">
        <a href="index.html" class="brand">
            <img src="image.png" alt="CSE logo">
            <div>
                <h1>CSE Department</h1>
                <div class="brand-sub">SRM Valliammai Engineering College</div>
            </div>
        </a>

        <div class="menu">
            <a href="index.html">Home</a>
        </div>
    </div>
</nav>

<div class="loader" id="loader"></div>

<main id="loginScreen" class="login-screen">
    <h2>Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter Password" />
    <button class="btn-primary" id="loginBtn">Login</button>
    <div class="login-error" id="loginError"></div>
</main>

<main id="adminPanel" class="admin-page">
    <h2>Content Update Panel</h2>
    <p>Submit updates securely. Refreshing logs out this session.</p>

    <div class="admin-grid">

        <div class="admin-card">
            <h3>Placement Upload</h3>
            <button class="btn-primary" data-target="placementFrame">Open</button>
            <button class="btn-primary" data-close="placementFrame">Close</button>
            <div class="form-frame" id="placementFrame"><iframe></iframe></div>
        </div>

        <div class="admin-card">
            <h3>Achievements & Events</h3>
            <button class="btn-primary" data-target="achievementsFrame">Open</button>
            <button class="btn-primary" data-close="achievementsFrame">Close</button>
            <div class="form-frame" id="achievementsFrame"><iframe></iframe></div>
        </div>

        <div class="admin-card">
            <h3>Coderizz Club</h3>
            <button class="btn-primary" data-target="coderizzFrame">Open</button>
            <button class="btn-primary" data-close="coderizzFrame">Close</button>
            <div class="form-frame" id="coderizzFrame"><iframe></iframe></div>
        </div>

    </div>
</main>


<script>

// ========= SETTINGS =========
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwhl98Lb9ID0cNEE49_MSQZrX52KYJ5fEf9ci8HKB2fZnj_7DgOjPaSOnCm5hjcymDC/exec"; // ← Replace later

const loader = document.getElementById("loader");
const loginScreen = document.getElementById("loginScreen");
const adminPanel = document.getElementById("adminPanel");
const loginError = document.getElementById("loginError");
const passInput = document.getElementById("adminPass");

function showLoader(){ loader.style.display="block"; }
function hideLoader(){ loader.style.display="none"; }

// ========= SECURITY BLOCKINGS =========
document.addEventListener("contextmenu", e => e.preventDefault());
document.onkeydown = e => {
    if(["F12"].includes(e.key) || (e.ctrlKey && e.shiftKey)) return false;
};

// ========= LOGIN FUNCTION =========
async function handleLogin() {
    const password = passInput.value.trim();
    if (!password) {
        loginError.textContent = "Enter password";
        loginError.style.display = "block";
        return;
    }
    showLoader();

    const res = await fetch(SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password })
    });

    const data = await res.json();
    hideLoader();

    if(!data.success){
        loginError.textContent = "Incorrect Password!";
        loginError.style.display = "block";
        return;
    }

    sessionStorage.setItem("token", data.token);
    loginScreen.style.display="none";
    loadConfig(data.token);
}

loginBtn.addEventListener("click", handleLogin);
passInput.addEventListener("keydown", e => { if(e.key==="Enter") handleLogin(); });

// ========= LOAD SECURE FORMS =========
async function loadConfig(token){
    showLoader();
    const res = await fetch(`${SCRIPT_URL}?token=${token}`);
    const cfg = await res.json();

    if(cfg.error){
        sessionStorage.clear();
        alert("Session expired. Login again.");
        location.reload();
        return;
    }

    document.querySelector("#placementFrame iframe").src = cfg.placementForm;
    document.querySelector("#achievementsFrame iframe").src = cfg.achievementForm;
    document.querySelector("#coderizzFrame iframe").src = cfg.coderizzForm;

    hideLoader();
    adminPanel.style.display="block";
}

// ========= HANDLE REFRESH LOGOUT =========
window.addEventListener("load", ()=>{
    const token = sessionStorage.getItem("token");
    if(!token) return;

    alert("Page refresh logs out the session!");
    sessionStorage.clear();
    location.href = "admin.html";
});

// ========= TOGGLE IFRAMES =========
document.querySelectorAll("[data-target]").forEach(btn =>
btn.addEventListener("click", () =>
    document.getElementById(btn.dataset.target).style.display="block"
));

document.querySelectorAll("[data-close]").forEach(btn =>
btn.addEventListener("click", () =>
    document.getElementById(btn.dataset.close).style.display="none"
));

</script>

</body>
</html>
